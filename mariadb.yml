- hosts: db
  vars_files:
    - ~/Ansible/vars/vars.yml
  tasks: 
  
  - name: install Python
    yum: name=MySQL-python state=latest

  - name: install MariaDB
    yum: name=mariadb-server state=latest

  - name: start mariadb
    service: name=mariadb enabled=true state=started
  
  - name: Start and enable firewall
    service:
      name: firewalld
      state: started
      enabled: yes

  - name: Configure firewall for DB
    firewalld:
      port: 3306/tcp
      permanent: yes
      state: enabled

  - name: Reload firewall
    service:
      name: firewalld
      state: reloaded

  - name: generate script for db
    template: src={{ source_template }}/db.sql dest=~/

  - name: create db 
    mysql_db:
      state: import
      name: all
      target: ~/db.sql

  #- name: create db 
  #  mysql_db:
  #    login_user: root
  #    name: gogs
  #    state: present

  #- name: change root password
  #  mysql_user:
  #    login_user: root
  #    name: root
  #    password: "{{ db_password }}"