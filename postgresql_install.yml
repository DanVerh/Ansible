- host: db
  become: yes

  pre_tasks:
  - name: Install postgresql
    yum: name=postgresql state=present
  - name: Install postgresql-server
    yum: name=postgresql-server state=present 
  - name: Install Python packages
    yum: name=python3-psycopg2  state=present

  tasks:
  - name: "Initialize PostgreSQL"
    shell: "postgresql-setup initdb"
  - name: "Start and enable services"
    service: "name={{ item }} state=started enabled=yes"
    with_items:
      - postgresql
    
  handlers:
  - name: restart postgres
    service: name=postgresql state=restarted