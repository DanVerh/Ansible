- host: db
  become: yes

  pre_tasks:
  - name: "Install packages"
    dnf: "name={{ item }} state=present"
    with_items:
      - postgresql
      - postgresql-server
  - name: "Install Python packages"
    yum: "name={{ item }}  state=present"
    with_items:
      - python3-psycopg2

  tasks:
  - name: "Initialize PostgreSQL"
    shell: "postgresql-setup initdb"
  - name: "Start and enable services"
    service: "name={{ item }} state=started enabled=yes"
    with_items:
      - postgresql
    
  handlers:
  - name: restart postgres
    service: name=postgresql state=restarted